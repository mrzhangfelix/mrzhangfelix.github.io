## **一、什么是nginx?**

Nginx是一款高性能的http 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器。由俄罗斯的程序设计师Igor Sysoev所开发，官方测试nginx能够支支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定。而tomcat只支持5百并发。

## **二、应用场景**

1、http服务器。Nginx是一个http服务可以独立提供http服务。可以做网页静态服务器。

2、虚拟主机。可以实现在一台服务器虚拟出多个网站。例如个人网站使用的虚拟主机。

3、反向代理，负载均衡。当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群可以使用nginx做反向代理。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况。

## **配置虚拟主机**

**在nginx.cof中配置虚拟主机，一个server就是一个虚拟主机，一台服务器可虚拟出多个服务或网站。而配置一个虚拟主机就可直接复制一个server，改成自己的网站即可**

**server {
    listen    80;
    server_name localhost;
    \#charset koi8-r;
    \#access_log logs/host.access.log main;
    location / {
      root  html;
      index index.html index.htm;
    }
  }**

**}**

配置解析：

listen：是监听服务端口

server_name:是配置域名

location:是配置请求来了是去哪个地方找对应放入资源，就是欢迎页

root:对应html,html是一个目录，是相对路径，相对于nginx,但指定静态资源绝对路径也是可以的，

index：是指定欢迎页，就是访问页。

## **反向代理**

正向代理：简单一句话就是，谁替我上网，操作在用户。反向代理说的是服务端，指定谁能给你访问。其实就是请求转发。

## 负载均衡

其实就是tomcat服务器实现集群，因为一个tomcat支持5百并发，所以配置多个来达到负载均衡与并发，nginx是五集群的，他是一个入口，是一个7层负载=应用层。

8.1轮询

如果一个服务由多条服务器提供，需要把负载分配到不同的服务器处理，需要负载均衡。
 upstream tomcat2 {
server 192.168.25.148:8081;
server 192.168.25.148:8082;
 }
8.2权重
可以根据服务器的实际情况调整服务器权重。权重越高分配的请求越多，权重越低，请求越少。默认是都是1
 upstream tomcat2 {
server 192.168.25.148:8081;
server 192.168.25.148:8082 weight=2;
  }

九、nginx高可用

要实现nginx的高可用，需要实现备份机。就是增加冗余，增加备份，

##  什么是负载均衡高可用

nginx作为负载均衡器，所有请求都到了nginx，可见nginx处于非常重点的位置，如果nginx服务器宕机后端web服务将无法提供服务，影响严重。

为了屏蔽负载均衡服务器的宕机，需要建立一个备份机。主服务器和备份机上都运行高可用（High Availability）监控程序，通过传送诸如“I am alive”这样的信息来监控对方的运行状况。当备份机不能在一定的时间内收到这样的信息时，它就接管主服务器的服务IP并继续提供负载均衡服务；当备份管理器又从主管理器收到“I am alive”这样的信息时，它就释放服务IP地址，这样的主服务器就开始再次提供负载均衡服务。

## keepalived+nginx实现主备

### 什么是keepalived

keepalived是集群管理中保证集群高可用的一个服务软件，用来防止单点故障。

 Keepalived的作用是检测web服务器的状态，如果有一台web服务器死机，或工作出现故障，Keepalived将检测到，并将有故障的web服务器从系统中剔除，当web服务器工作正常后Keepalived自动将web服务器加入到服务器群中，这些工作全部自动完成，不需要人工干涉，需要人工做的只是修复故障的web服务器。

十、高并发

采用LVS,通过四层负载，在原来nginx七层之前提高负载能力。